document.querySelectorAll('[data-bs-toggle="modal"]').forEach((function(item,i,arr){initModal(item)}));function modalLink(item){if(typeof item.dataset.call!=="undefined"){return}if(item.classList.contains("prnt")===true||item.classList.contains("print")===true){item.dataset.call=true;return}item.addEventListener("click",(function(event){const modalData=new FormData;const formname=item.dataset.formname;document.querySelector("#modal .spinner-border")?.classList.remove("d-none");event.preventDefault();const request=new XMLHttpRequest;let url=null;if(this.href){url=item.href}else{url=item.dataset.href}if(!url){return}let METHOD=typeof item.dataset.method==="undefined"?"GET":item.dataset.method;const processFormData=function(item,collection_form_name,i){if(typeof item.dataset.formname==="undefined"){return false}const dataAttributes=item.dataset;for(const name in dataAttributes){if(name!=="formname"){const elem_formname=formname==="undefined"?item.dataset.formname:formname;modalData.append(elem_formname+"["+collection_form_name+"]"+"["+i+"]["+name+"]",dataAttributes[name])}}};if(item.dataset.postClass){let className=item.dataset.postClass;const collection_form_name=item.dataset.collectionForm;if(item.dataset.postClass==="add-one-to-collection"){processFormData(item,collection_form_name,0)}else{document.querySelectorAll("."+className+":checked").forEach((function(item,i,arr){processFormData(item,collection_form_name,i)}))}}request.open(METHOD,url);request.setRequestHeader("X-Requested-With","XMLHttpRequest");request.addEventListener("readystatechange",(function(evemnt){if(request.readyState===4&&request.status===200){const modal=document.getElementById("modal");modal.innerHTML=request.responseText;modal.addEventListener("hidden.bs.modal",(function(event){this.innerHTML='<div class="modal-dialog modal-dialog-centered"><div class="d-flex justify-content-center w-100"><div class="spinner-border text-light" role="status"><span class="visually-hidden">Loading...</span></div></div></div>'}));modal.addEventListener("shown.bs.modal",(function(event){var tooltipTriggerList=[].slice.call(modal.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map((function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)}))}));modal.querySelectorAll('[data-select="select2"]').forEach((function(item){new NiceSelect(item,{searchable:true})}));modal.querySelectorAll('[data-bs-target="#modal"]').forEach((function(item,i,arr){modalLink(item)}));var tooltipTriggerList=[].slice.call(modal.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map((function(tooltipTriggerEl){const tooltipInstance=new bootstrap.Tooltip(tooltipTriggerEl);tooltipTriggerEl.addEventListener("click",(event=>{tooltipInstance.hide()}));return tooltipInstance}));if($html){$html=request.responseText}let lazy=document.createElement("script");lazy.src="/assets/"+$version+"/js/lazyload.min.js?v="+Date.now();document.head.appendChild(lazy);let urlObject=createValidUrl(url);if(urlObject.searchParams.has("print")&&urlObject.searchParams.get("print")==="1"){window.print();setTimeout((function(){let currentmodal=bootstrap.Modal.getOrCreateInstance(modal);currentmodal.hide();document.getElementById("prnt").innerHTML=""}),10)}}else{if(request.status===302){let requestJson=JSON.parse(request.response);if(requestJson.redirect){window.location.href=requestJson.redirect}}}}));request.send(modalData);return false}));item.dataset.call=true}